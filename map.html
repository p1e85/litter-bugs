<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Litter Bugs - Map Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü™≤</text></svg>">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/mapstyle.css">
</head>
<body>

    <div class="top-bar-container">
        <div class="top-bar-left">
            <button id="infoBtn" class="top-bar-button">‚ÑπÔ∏è Info</button>
            <button id="communityBtn" class="community-button off">üåé Community View: OFF</button>
        </div>
        <a href="https://www.buymeacoffee.com/p1skates" target="_blank" class="donate-button">
            ‚òï Support the Mission
        </a>
    </div>

    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>About Litter Bugs</h2>
            <h4>The Mission (Why)</h4>
            <p>Litter Bugs transforms the chore of cleaning up our neighborhoods into a visible and rewarding achievement. By tracking your cleanup routes and pinning the litter you collect, you create a tangible record of your positive impact. Share your efforts on the community map to inspire others, see our collective progress, and help identify areas that need our attention the most.</p>
            <h4>How to Use the App</h4>
            <ol class="info-list">
                <li><strong>Sign Up or Skip:</strong> Create an account to save your data to the cloud, or 'Skip' to use the app as a guest (your data will be saved only on this browser).</li>
                <li><strong>Track a Route:</strong> Press 'Start Tracking' to draw your path on the map as you walk.</li>
                <li><strong>Pin Garbage:</strong> When you find litter, press 'Pin Picture' to take a photo. This will drop a pin at your location.</li>
                <li><strong>Save/Load:</strong> Use the 'Data' button to save your current session or load a previous one. You can save multiple named sessions.</li>
                <li><strong>Publish:</strong> When logged in, you can use the 'Publish to Community' button to share your completed route with everyone.</li>
                <li><strong>Community View:</strong> Toggle the 'Community View' button to see all the routes published by other users!</li>
            </ol>
            <p class="tos-link-container">You can review the full <a href="#" id="viewTermsLink">Terms of Use</a> at any time.</p>
        </div>
    </div>
    
    <div id="termsModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Terms of Use</h2>
            <div class="terms-box">
                <p><strong>AGE REQUIREMENT:</strong> You must be 18 years of age or older to use this Service, including creating an account or using it as a guest. By using this Service, you represent and warrant that you are 18 years of age or older.</p>
                <p>Welcome to Litter Bugs! By accessing or using our application (the "Service"), you agree to be bound by these Terms of Use.</p>
                <p><strong>1. Description of Service:</strong> This Service is for the sole purpose of identifying and documenting refuse, trash, and litter (collectively, "Garbage").</p>
                <p><strong>2. Prohibited Content:</strong> You may NOT upload any photograph containing people, illegal activities, or personal information. The focus must be exclusively on Garbage.</p>
                <p><strong>3. Disclaimer:</strong> This Service is provided "AS IS". Your use of this service is entirely at your own risk. We are not liable for any damages or harm arising from your use of the Service.</p>
            </div>
            <div class="agreement-section">
                <input type="checkbox" id="termsCheckbox">
                <label for="termsCheckbox">I have read, understood, and agree to the Terms of Use.</label>
            </div>
            <button id="agreeBtn" disabled>I Agree</button>
        </div>
    </div>
    
    <div id="authModal" class="modal-overlay">
        <div class="modal-content auth-modal">
            <h2 id="authTitle">Create an Account</h2>
            <p id="authSubtitle">Or <a href="#" id="switchAuthModeLink">log in to an existing account.</a></p>
            <div id="authForm" class="auth-form signup-mode">
                <input type="text" id="usernameInput" placeholder="Public Username">
                <input type="email" id="emailInput" placeholder="Email (for login)">
                <input type="password" id="passwordInput" placeholder="Password (min. 6 characters)">
                <div id="ageGateContainer" class="age-gate-container">
                    <input type="checkbox" id="ageCheckbox">
                    <label for="ageCheckbox">I certify that I am 18 years of age or older.</label>
                </div>
                <button id="authActionBtn" disabled>Sign Up</button>
            </div>
            <hr>
            <button id="skipBtn" class="skip-button">Skip for now</button>
            <p id="authError" class="error-message"></p>
        </div>
    </div>
    
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Edit Your Public Profile</h2>
            <p>This information will be visible to other users when they click your username on the community map.</p>
            <div class="profile-form">
                <label for="bioInput">Short Bio</label>
                <textarea id="bioInput" placeholder="Tell the community a little about yourself..." maxlength="150"></textarea>
                <label for="locationInput">Location</label>
                <input type="text" id="locationInput" placeholder="e.g., Chicago, IL" maxlength="50">
                <label for="coffeeLinkInput">"Buy Me a Coffee" Link</label>
                <input type="url" id="coffeeLinkInput" placeholder="https://www.buymeacoffee.com/yourname">
                <button id="saveProfileBtn" class="modal-button">Save Profile</button>
                <hr>
                <button id="deleteAccountBtn" class="modal-button delete-account-button">Permanently Delete Account</button>
            </div>
        </div>
    </div>

    <div id="publicProfileModal" class="modal">
        <div class="modal-content profile-modal">
            <span class="close-btn">&times;</span>
            <h2 id="profileUsername"></h2>
            <p id="profileLocation" class="profile-location"></p>
            <p id="profileBio" class="profile-bio"></p>
            <button id="profileSupportBtn" class="modal-button support-button">‚òï Support Them</button>
        </div>
    </div>

    <div id='map'></div>

    <div class="bottom-container">
        <div id="userStatus" class="user-status-display">
            <div id="loggedInContent">
                <span id="userEmail"></span>
                <button id="logoutBtn">Log Out</button>
            </div>
            <div id="guestContent">
                <span>Guest Mode</span>
                <button id="loginSignupBtn">Log In / Sign Up</button>
            </div>
        </div>
        <div class="controls">
            <button id="findMeBtn">üìç Find Me</button>
            <button id="trackBtn">üõ∞Ô∏è Start Tracking</button>
            <input type="file" accept="image/*" capture="environment" id="cameraInput" style="display: none;">
            <button id="pictureBtn">üì∏ Pin Picture</button>
            <button id="dataBtn">üíæ Data</button>
        </div>
    </div>

    <div id="dataModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Data Management</h2>
            <p>Manage your private sessions or your public contributions.</p>
            <button id="editProfileBtn" class="modal-button edit-profile">üë§ Edit My Profile</button>
            <button id="saveBtn" class="modal-button">Save Private Session</button>
            <button id="loadBtn" class="modal-button">Load Private Session</button>
            <button id="managePublicationsBtn" class="modal-button manage">Manage My Publications</button>
            <hr>
            <p>Publish your completed route to the public community map for everyone to see.</p>
            <button id="publishBtn" class="modal-button publish">üöÄ Publish to Community</button>
            <hr>
            <p>Export your current session as a GeoJSON file.</p>
            <button id="exportBtn" class="modal-button export">Export as GeoJSON</button>
        </div>
    </div>

    <div id="sessionsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Load a Private Session</h2>
            <p>Select a previously saved session to load it onto the map.</p>
            <ul id="sessionList" class="session-list"></ul>
        </div>
    </div>

    <div id="localSessionsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Load a Local Session</h2>
            <p>Select a session saved on this browser to load it.</p>
            <ul id="localSessionList" class="session-list"></ul>
        </div>
    </div>

    <div id="publishedRoutesModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Manage My Published Routes</h2>
            <p>Here you can view and permanently delete your contributions to the community map.</p>
            <ul id="publishedRoutesList" class="session-list"></ul>
        </div>
    </div>
    
    <div id="safetyModal" class="modal">
        <div class="modal-content safety-modal">
            <span class="close-btn">&times;</span>
            <h2>Be Safe Out There!</h2>
            <p>A quick reminder before you start your cleanup:</p>
            <ul class="info-list">
                <li><strong>Gear Up:</strong> Always consider using gloves and sturdy trash bags.</li>
                <li><strong>Be Aware:</strong> Watch out for traffic, sharp objects, and wildlife.</li>
                <li><strong>Don't Risk It:</strong> If an item looks hazardous or is in an unsafe location, leave it. Your safety is the top priority!</li>
            </ul>
            <button id="safetyModalOkBtn" class="modal-button">Got it, Let's Go!</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <script src="js/mapscript.js" type="module"></script>

</body>
</html>