<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Litter Bugs - Map Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü™≤</text></svg>">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
        <!-- NEW: Google reCAPTCHA Library -->
    <script src="https://www.google.com/recaptcha/enterprise.js?render=6LeIydQrAAAAAG1NltEKy06_5Ny044YzP2GBPkmf"></script>
    <link rel="stylesheet" href="css/maptest.css">
</head>
<body>

    <!-- Top Bar Container (RESTRUCTURED) -->
    <div class="top-bar-container">
        <!-- This group will be on the left on desktop -->
        <div class="top-bar-left">
            <button id="leaderboardBtn" class="top-bar-button">üèÜ Leaderboard</button>
            <button id="communityBtn" class="community-button off">üåé Community View: OFF</button>
        </div>
        <!-- This group will be on the right on desktop -->
        <div class="top-bar-right">
            <button id="infoBtn" class="top-bar-button">‚ÑπÔ∏è Info</button>
            <button id="changeStyleBtn" class="top-bar-button">üé® Change Style</button>
            <button id="centerOnRouteBtn" class="top-bar-button" disabled>üéØ Find Route</button>
            <a href="https://www.buymeacoffee.com/p1skates" target="_blank" class="donate-button">
                ‚òï Support
            </a>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>About Litter Bugs</h2>
            <div class="info-modal-body">
                <h4>The Mission (Why)</h4>
                <p>Litter Bugs transforms the chore of cleaning up our neighborhoods into a visible and rewarding achievement. By tracking your cleanup routes and pinning the litter you collect, you create a tangible record of your positive impact. Share your efforts on the community map to inspire others, see our collective progress, and help identify areas that need our attention the most.</p>
                <h4>How to Use the App</h4>
                <ol class="info-list">
                    <li><strong>Sign Up or Skip:</strong> Create an account to save your data to the cloud, or 'Skip' to use the app as a guest (your data will be saved only on this browser).</li>
                    <li><strong>Track a Route:</strong> Press 'Start Tracking' to draw your path on the map as you walk.</li>
                    <li><strong>Pin Litter:</strong> When you find litter, press 'Pin Picture' to take a photo. This will drop a pin at your location.</li>
                    <li><strong>Save/Load:</strong> Use the 'Data' button to save your current session or load a previous one. You can save multiple named sessions.</li>
                    <li><strong>Publish:</strong> When logged in, you can use the 'Publish to Community' button to share your completed route with everyone.</li>
                    <li><strong>Community View:</strong> Toggle the 'Community View' button to see all the routes published by other users!</li>
                </ol>
            </div>
            <p class="tos-link-container">You can review the full <a href="#" id="viewTermsLink">Terms of Use</a> at any time.</p>
        </div>
    </div>
    
    <!-- Terms of Use Modal -->
    <div id="termsModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Terms of Use</h2>
            <div class="terms-box">
                <p><strong>AGE REQUIREMENT:</strong> You must be 18 years of age or older to use this Service, including creating an account or using it as a guest. By using this Service, you represent and warrant that you are 18 years of age or older.</p>
                <p>Welcome to Litter Bugs! By accessing or using our application (the "Service"), you agree to be bound by these Terms of Use.</p>
                <p><strong>1. Description of Service:</strong> This Service is for the sole purpose of identifying and documenting refuse, trash, and litter (collectively, "Garbage").</p>
                <p><strong>2. Prohibited Content:</strong> You may NOT upload any photograph containing people, illegal activities, or personal information. The focus must be exclusively on Garbage.</p>
                <p><strong>3. Disclaimer:</strong> This Service is provided "AS IS". Your use of this service is entirely at your own risk. We are not liable for any damages or harm arising from your use of the Service.</p>
            </div>
            <div class="agreement-section">
                <input type="checkbox" id="termsCheckbox">
                <label for="termsCheckbox">I have read, understood, and agree to the Terms of Use.</label>
            </div>
            <button id="agreeBtn" disabled>I Agree</button>
        </div>
    </div>
    
    <!-- Authentication Modal -->
    <div id="authModal" class="modal-overlay">
        <div class="modal-content auth-modal">
            <h2 id="authTitle">Create a Litter Bugs Account</h2>
            <p id="authSubtitle">Or <a href="#" id="switchAuthModeLink">log in to an existing account.</a></p>
            <div id="authForm" class="auth-form signup-mode">
                <input type="text" id="usernameInput" placeholder="Public Username">
                <input type="email" id="emailInput" placeholder="Email (for login)">
                <input type="password" id="passwordInput" placeholder="Password (min. 6 characters)">
                <div id="ageGateContainer" class="age-gate-container">
                    <input type="checkbox" id="ageCheckbox">
                    <label for="ageCheckbox">I certify that I am 18 years of age or older.</label>
                </div>

                <!-- NEW: reCAPTCHA Container -->
                <div id="recaptcha-container" class="recaptcha-container"></div>
                
                <button id="authActionBtn" disabled>Sign Up</button>
            </div>
            <hr>
            <button id="skipBtn" class="skip-button">Skip for now</button>
            <p id="authError" class="error-message"></p>
        </div>
    </div>
    
    <!-- Modal for Editing User Profile -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Edit Your Public Profile</h2>
            <p>This information will be visible to other users when they click your username on the community map.</p>
            <div class="profile-form">
                <label for="bioInput">Short Bio</label>
                <textarea id="bioInput" placeholder="Tell the community a little about yourself..." maxlength="150"></textarea>
                <label for="locationInput">Location</label>
                <input type="text" id="locationInput" placeholder="e.g., Chicago, IL" maxlength="50">
                <label for="coffeeLinkInput">"Buy Me a Coffee" Link</label>
                <input type="url" id="coffeeLinkInput" placeholder="https://www.buymeacoffee.com/yourname">
                <button id="saveProfileBtn" class="modal-button">Save Profile</button>
                <hr>
                <button id="deleteAccountBtn" class="modal-button delete-account-button">Permanently Delete Account</button>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing a Public User Profile -->
    <div id="publicProfileModal" class="modal">
        <div class="modal-content profile-modal">
            <span class="close-btn">&times;</span>
            <h2 id="profileUsername"></h2>
            <p id="profileLocation" class="profile-location"></p>
            <p id="profileBio" class="profile-bio"></p>
            <hr>
            <h4>Achievements</h4>
            <div id="profileAchievements" class="badge-container"></div>
            <button id="profileSupportBtn" class="modal-button support-button">‚òï Support Them</button>
        </div>
    </div>

    <!-- Safety Reminder Modal -->
    <div id="safetyModal" class="modal">
        <div class="modal-content safety-modal">
            <span class="close-btn">&times;</span>
            <h2>Be Safe Out There!</h2>
            <p>A quick reminder before you start your cleanup:</p>
            <ul class="info-list">
                <li><strong>Gear Up:</strong> Always consider using gloves and sturdy trash bags.</li>
                <li><strong>Be Aware:</strong> Watch out for traffic, sharp objects, and wildlife.</li>
                <li><strong>Don't Risk It:</strong> If an item looks hazardous or is in an unsafe location, leave it. Your safety is the top priority!</li>
            </ul>
            <button id="safetyModalOkBtn" class="modal-button">Got it, Let's Go!</button>
        </div>
    </div>
    
    <!-- Post-Cleanup Summary Modal -->
    <div id="summaryModal" class="modal">
        <div class="modal-content summary-modal">
            <span class="close-btn">&times;</span>
            <h2>Great Job!</h2>
            <p>Here's a summary of your cleanup session:</p>
            <div class="summary-stats">
                <div>
                    <span class="stat-value" id="summaryDistance">0.0 mi</span>
                    <span class="stat-label">Distance</span>
                </div>
                <div>
                    <span class="stat-value" id="summaryPins">0</span>
                    <span class="stat-label">Items Pinned</span>
                </div>
                <div>
                    <span class="stat-value" id="summaryDuration">0m 0s</span>
                    <span class="stat-label">Duration</span>
                </div>
            </div>
            <!-- NEW: Share Button -->
            <button id="shareBtn" class="modal-button share-button">üì£ Share Your Cleanup!</button>
            <button id="summaryOkBtn" class="modal-button">Awesome!</button>
        </div>
    </div>
    
    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Community Leaderboard</h2>
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab" id="myStatsBtn">My Stats</button>
                <button class="leaderboard-tab active" data-metric="totalPins">Most Pins Collected</button>
                <button class="leaderboard-tab" data-metric="totalDistance">Most Distance Cleaned</button>
            </div>
            <ol id="leaderboardList" class="leaderboard-list"></ol>
            <div id="myStatsContainer" class="my-stats-container" style="display: none;"></div>
        </div>
    </div>

    <!-- Achievement Unlocked Modal -->
    <div id="achievementModal" class="modal">
        <div class="modal-content achievement-modal">
            <span class="achievement-icon"></span>
            <h2>Achievement Unlocked!</h2>
            <h3 id="achievementName"></h3>
            <p id="achievementDescription"></p>
            <button id="achievementOkBtn" class="modal-button">Awesome!</button>
        </div>
    </div>

    <!-- Schedule a Meetup Modal -->
    <div id="meetupModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Schedule a Meetup</h2>
            <p>Organize a cleanup event at: <strong id="meetupLocationName"></strong></p>
            <div id="meetupForm" class="profile-form">
                <input type="hidden" id="poiNameInput">
                <label for="meetupTitleInput">Meetup Title</label>
                <input type="text" id="meetupTitleInput" placeholder="e.g., Saturday Morning Cleanup" maxlength="50">
                <label for="meetupDescriptionInput">Description</label>
                <textarea id="meetupDescriptionInput" placeholder="e.g., Let's meet by the main entrance at 9 AM!" maxlength="200"></textarea>
                
                <div class="safety-disclaimer">
                    <strong>Safety First:</strong> You are organizing a public event. For your safety and the safety of others, always meet in well-lit, public places and be aware of your surroundings. Litter Bugs is a platform for connecting people; we are not responsible for any incidents that occur at user-organized meetups.
                </div>
                <div class="agreement-section">
                    <input type="checkbox" id="safetyCheckbox">
                    <label for="safetyCheckbox">I understand and agree to the safety guidelines.</label>
                </div>
                <p id="profanityWarning" class="error-message" style="display: none;">Please use appropriate language.</p>
                <button id="createMeetupBtn" class="modal-button" disabled>Create Meetup</button>
            </div>
        </div>
    </div>

    <!-- View Scheduled Meetups Modal -->
    <div id="viewMeetupsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Scheduled Meetups at <strong id="viewMeetupsLocationName"></strong></h2>
            <ul id="meetupsList" class="session-list"></ul>
        </div>
    </div>

    <!-- Map container -->
    <div id='map'></div>

    <!-- Bottom Container -->
    <div class="bottom-container">
        <div id="userStatus" class="user-status-display">
            <div id="loggedInContent">
                <span id="userEmail"></span>
                <button id="logoutBtn">Log Out</button>
            </div>
            <div id="guestContent">
                <span>Guest Mode</span>
                <button id="loginSignupBtn">Log In / Sign Up</button>
            </div>
        </div>
        <div class="controls">
            <button id="findMeBtn">üìç Find Me</button>
            <button id="trackBtn">üõ∞Ô∏è Start Tracking</button>
            <input type="file" accept="image/*" capture="environment" id="cameraInput" style="display: none;">
            <button id="pictureBtn">üì∏ Pin Picture</button>
            <button id="dataBtn">üíæ Data</button>
        </div>
    </div>

    <!-- Data Management Modal -->
    <div id="dataModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Data Management</h2>
            <p>Manage your private sessions or your public contributions.</p>
            <button id="editProfileBtn" class="modal-button edit-profile">üë§ Edit My Profile</button>
            <button id="saveBtn" class="modal-button">Save Private Session</button>
            <button id="loadBtn" class="modal-button">Load Private Session</button>
            <button id="managePublicationsBtn" class="modal-button manage">Manage My Publications</button>
            <hr>
            <p>Publish your completed route to the public community map for everyone to see.</p>
            <button id="publishBtn" class="modal-button publish">üöÄ Publish to Community</button>
            <hr>
            <p>Export your current session as a GeoJSON file.</p>
            <button id="exportBtn" class="modal-button export">Export as GeoJSON</button>
        </div>
    </div>

    <!-- Saved Cloud Sessions Modal -->
    <div id="sessionsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Load a Private Session</h2>
            <p>Select a previously saved session to load it onto the map.</p>
            <ul id="sessionList" class="session-list"></ul>
        </div>
    </div>

    <!-- Saved Local Sessions Modal -->
    <div id="localSessionsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Load a Local Session</h2>
            <p>Select a session saved on this browser to load it.</p>
            <p class="disclaimer-text">
                <strong>Note:</strong> As a guest, sessions are saved only to this browser. They will be lost if you clear your cache or switch devices. Sign up for a free account to save your data permanently!
            </p>
            <ul id="localSessionList" class="session-list"></ul>
        </div>
    </div>

    <!-- Published Routes Modal -->
    <div id="publishedRoutesModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Manage My Published Routes</h2>
            <p>Here you can view and permanently delete your contributions to the community map.</p>
            <ul id="publishedRoutesList" class="session-list"></ul>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <script src="js/maptest.js" type="module"></script>

</body>
</html>

